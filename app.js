function computeCounters(s){const t=s.items.length;let d=0,st=0,sk=0;for(let i=0;i<t;i++){if(s.checked[i])d++;if(s.flags[i]==="stopped")st++;if(s.flags[i]==="skip")sk++;}return{done:d,stopped:st,skip:sk,total:t};}
function loadCityState(c){try{return JSON.parse(localStorage.getItem("junkai_"+c))||{items:[],checked:[],flags:[],dates:[]}}catch(_){return{items:[],checked:[],flags:[],dates:[]}}}
function badgeHTML(k){return `<span class='badge done'>済 ${k.done}</span><span class='badge stop'>停 ${k.stopped}</span><span class='badge skip'>不 ${k.skip}</span><span class='badge total'>総 ${k.total}</span>`}
function updateCounts(){const cs=["yamato","ebina","chofu"];let ad=0,as=0,ak=0,at=0;for(const c of cs){const s=loadCityState(c);const k=computeCounters(s);ad+=k.done;as+=k.stopped;ak+=k.skip;at+=k.total;const el=document.getElementById(c+"_count");if(el)el.innerHTML=badgeHTML(k);}const all=document.getElementById("all_count");if(all)all.innerHTML=badgeHTML({done:ad,stopped:as,skip:ak,total:at});}
function initIndex(){const any=loadCityState("yamato").items.length+loadCityState("ebina").items.length+loadCityState("chofu").items.length;document.getElementById("placeholder").style.display=any?"none":"block";updateCounts();}
// syncFromGAS is assumed defined already in existing app.js; keep it unchanged
