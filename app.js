
const GAS_URL="https://script.google.com/macros/s/AKfycbytPvlFPvOmcaNr0u4LgLqG7VWYOa9oFz6HjV00RaNv1zTMRlzLyuv-X1a5qVH7bqVY0w/exec";
function loadCityState(c){try{return JSON.parse(localStorage.getItem("junkai_"+c))||{items:[],checked:[],flags:[],dates:[]}}catch(e){return{items:[],checked:[],flags:[],dates:[]}}}
function saveCityState(c,s){localStorage.setItem("junkai_"+c,JSON.stringify(s));}
async function syncFromGAS(){try{let res=await fetch(GAS_URL+"?action=pull");if(!res.ok)throw new Error(res.statusText);let obj=await res.json();if(!obj.ok||!Array.isArray(obj.data))throw new Error("bad JSON");let buckets={yamato:[],ebina:[],chofu:[]};for(let r of obj.data){let key=r.city.includes("大和")?"yamato":r.city.includes("海老名")?"ebina":r.city.includes("調布")?"chofu":"";if(!key)continue;buckets[key].push({station:r.station||"",model:r.model||"",plate:r.plate_full||""});};for(let k of Object.keys(buckets)){let items=buckets[k];let state={items:items,checked:items.map(_=>false),flags:items.map(_=>""),dates:items.map(_=>null)};saveCityState(k,state);}alert("同期完了");}catch(e){alert("同期失敗:"+e.message)}}
