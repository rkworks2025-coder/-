<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>海老名市 巡回リスト</title>
<style>
  :root { --bg:#f5f6f8; --panel:#ffffff; --panel2:#f9fafb; --border:#e5e7eb; --text:#111827; --muted:#6b7280; --accent:#2563eb; --pink:#ffc0cb; --stopped:#9ca3af; --skip:#fff3b0; }
  * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  body { margin:0; background:var(--bg); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif; }
  header { position:sticky; top:0; background:#ffffffcc; backdrop-filter:saturate(180%) blur(8px); border-bottom:1px solid var(--border); padding:8px; display:flex; align-items:center; gap:8px; }
  h1 { flex:1; text-align:center; margin:0; font-size:16px; color:var(--accent); letter-spacing:.02em; }
  .toolbar { display:flex; gap:8px; }
  .btn { appearance:none; border:1px solid var(--border); background:var(--panel2); color:var(--text); padding:8px 10px; border-radius:10px; font-size:12px; }
  .btn:active { transform:scale(.98); }
  main { padding:12px; padding-bottom:90px; }
  .item { background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:12px; margin-bottom:10px; display:flex; align-items:center; justify-content:space-between; gap:10px; }
  .name { font-weight:600; flex:1; }
  .checked { background:var(--pink); }
  .stopped { background:#eceff3; color:#374151; border-color:#cfd6df; }
  .skip { background:var(--skip); color:#111; }
  .badges { display:flex; align-items:center; gap:6px; }
  .badge { font-size:11px; padding:2px 6px; border-radius:999px; border:1px solid var(--border); color:#374151; background:var(--panel2); }
  .counter { position:sticky; bottom:0; background:#ffffffcc; border-top:1px solid var(--border); padding:12px; display:flex; justify-content:space-between; align-items:center; backdrop-filter:saturate(180%) blur(8px); }
  a { color:var(--accent); text-decoration:none; }
</style>
</head>
<body>
<header>
  <div class="toolbar">
    <button class="btn" onclick="checkAll(true)">全てをチェック</button>
    <button class="btn" onclick="checkAll(false)">全て外す</button>
    <button class="btn" onclick="resetState()">リセット</button>
    <button class="btn" onclick="addItem()">＋追加</button>
  </div>
  <h1>海老名市 巡回リスト</h1>
</header>
<main id="list"></main>
<div class="counter">
  <div><a href="index.html">← 戻る</a></div>
  <div id="count">0/0 (0%)</div>
</div>
<script>
  const CITY_KEY = "junkai_ebina";
  const CONFIRM_MSG = "よろしいですか？";
  const listEl = document.getElementById("list");
  function loadState(){
    try{ 
      return JSON.parse(localStorage.getItem(CITY_KEY)) || {
        items:["ステーション001","ステーション002","ステーション003"],
        checked:[false,false,false],
        flags:["","",""]
      };
    }catch(e){
      return { items:["ステーション001","ステーション002","ステーション003"], checked:[false,false,false], flags:["","",""] };
    }
  }
  function saveState(s){ localStorage.setItem(CITY_KEY, JSON.stringify(s)); }
  let state = loadState();
  function render(){
    listEl.innerHTML = "";
    state.items.forEach((name,i)=>{
      const row = document.createElement("div");
      let cls = "item";
      if(state.flags[i]==="stopped") cls += " stopped";
      else if(state.flags[i]==="skip") cls += " skip";
      if(state.checked[i]) cls += " checked";
      row.className = cls;

      const left = document.createElement("div");
      left.className="name";
      left.textContent = name;

      const badges = document.createElement("div");
      badges.className="badges";
      if(state.flags[i]==="stopped"){ 
        const b=document.createElement("span"); b.className="badge"; b.textContent="稼働停止"; badges.appendChild(b);
      }
      if(state.flags[i]==="skip"){ 
        const b=document.createElement("span"); b.className="badge"; b.textContent="巡回不要"; badges.appendChild(b);
      }

      const btnBox = document.createElement("div");
      const btnCheck = document.createElement("button");
      btnCheck.className="btn";
      btnCheck.textContent = state.checked[i] ? "✔" : "□";
      btnCheck.onclick = ()=>toggle(i);

      const btnFlag = document.createElement("button");
      btnFlag.className="btn";
      btnFlag.textContent = "状態";
      btnFlag.onclick = ()=>setFlag(i);

      btnBox.appendChild(btnFlag);
      btnBox.appendChild(btnCheck);

      row.appendChild(left);
      row.appendChild(badges);
      row.appendChild(btnBox);
      listEl.appendChild(row);
    });
    updateCount();
  }
  function toggle(i){
    if(!confirm(CONFIRM_MSG)) return;
    state.checked[i] = !state.checked[i];
    saveState(state); render();
  }
  function setFlag(i){
    const v = prompt("状態を選択：\n0=通常\n1=稼働停止(グレー)\n2=巡回不要(黄色)", "0");
    if(v===null) return;
    if(v==="1") state.flags[i]="stopped";
    else if(v==="2") state.flags[i]="skip";
    else state.flags[i]="";
    saveState(state); render();
  }
  function updateCount(){
    const total = state.items.length;
    const done = state.checked.filter(Boolean).length;
    const pct = total? Math.round(done/total*100):0;
    document.getElementById("count").textContent = `${done}/${total} (${pct}%)`;
  }
  function checkAll(val){
    if(!confirm(CONFIRM_MSG)) return;
    state.checked = state.items.map(()=>val);
    saveState(state); render();
  }
  function resetState(){
    if(!confirm("すべて初期化します。よろしいですか？")) return;
    state = { items:["ステーション001","ステーション002","ステーション003"], checked:[false,false,false], flags:["","",""] };
    saveState(state); render();
  }
  function addItem(){
    const name = prompt("ステーション名を追加：");
    if(!name) return;
    state.items.push(name);
    state.checked.push(false);
    state.flags.push("");
    saveState(state); render();
  }
  render();
</script>
</body>
</html>
