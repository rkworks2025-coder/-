<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>調布市 巡回</title>
<script>var ENDPOINT="https://script.google.com/macros/s/AKfycbzjsPGgz2LRNs5uRcwql6B4bqafRR1JkwMfPQiyyShwyQZzmVGiWbTUuWhJV_q4g-kfpA/exec";var SECRET="rkw123";</script>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f6f7fb;color:#111}
header{position:sticky;top:0;background:#fff;padding:12px 16px;border-bottom:1px solid #e6e8ee}
.card{display:flex;align-items:center;gap:12px;background:#fff;border:1px solid #e6e8ee;border-radius:14px;padding:12px;margin:10px}
.card.checked{background:#ffe8ef;border-color:#f8c9d7}
.chk{margin-right:8px}
.date-badge{min-width:54px;text-align:center;color:#6b7280;font-weight:700}
</style>
<header><a href="index.html">戻る</a> / <strong>調布市 巡回</strong> <span id="count" style="float:right">0/1</span></header>
<div class="card" data-station="デモ" data-model="ノート" data-plate="相模000あ0000">
  <input type="checkbox" class="chk">
  <div class="body"><div class="title">デモ ステーション</div><div class="meta">ノート / 相模000あ0000</div></div>
  <div class="date-badge"></div>
</div>
<script>
(function(){
  var CITY="調布市";
  var cards=[].slice.call(document.querySelectorAll('.card')); var countEl=document.getElementById('count');
  function fmtDate(d){var m=('0'+(d.getMonth()+1)).slice(-2), day=('0'+d.getDate()).slice(-2); return m+'-'+day;}
  function update(){var c=cards.filter(c=>c.classList.contains('checked')).length;if(countEl)countEl.textContent=c+"/1";}
  function saveKey(i){return 'chk:'+CITY+':'+i;}
  function save(i,checked,date){localStorage.setItem(saveKey(i), JSON.stringify({checked:checked,date:date}));}
  function post(p){try{fetch(ENDPOINT,{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify(Object.assign({secret:SECRET},p))})}catch(e){}}
  function onPayload(card,i,ds){return{ts:new Date().toISOString(),city:CITY,index:i,station_name:card.getAttribute('data-station')||'',vehicle_model:card.getAttribute('data-model')||'',plate_number:card.getAttribute('data-plate')||'',date_badge:ds,checked:true}}
  function offPayload(card){return{city:CITY,plate_number:card.getAttribute('data-plate')||'',delete:true}}
  cards.forEach(function(card,i){var chk=card.querySelector('.chk');var badge=card.querySelector('.date-badge');
    chk.addEventListener('change',function(){var ds=fmtDate(new Date());if(chk.checked){card.classList.add('checked');badge.textContent=ds;save(i,true,ds);post(onPayload(card,i,ds));}else{card.classList.remove('checked');badge.textContent='';save(i,false,'');post(offPayload(card));}update();});
  });
  update();
})();
</script>
