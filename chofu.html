<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>調布市 巡回</title>

<style>
  :root{ --bg:#f6f7fb; --surface:#fff; --border:#e6e8ee; --text:#111; --muted:#6b7280; --accent:#111; --checked:#ffe8ef; }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header{position:sticky;top:0;background:var(--surface);padding:12px 16px;border-bottom:1px solid var(--border);z-index:10;display:flex;gap:8px;align-items:center}
  header .back{text-decoration:none;border:1px solid var(--border);padding:8px 12px;border-radius:12px;color:var(--text)}
  header h1{margin:0;font-size:18px;flex:1;text-align:center}
  header .count{font-weight:700;color:var(--muted);font-variant-numeric:tabular-nums}
  main{padding:12px 12px 24px;max-width:820px;margin:0 auto}
  .toolbar{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap;justify-content:center}
  .pill{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:var(--surface);text-decoration:none;color:var(--text);cursor:pointer}
  .danger{color:#b42318;border-color:#f2c6c4;background:#fff5f4}
  .card{display:flex;align-items:center;gap:12px;background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:12px;margin-bottom:10px;box-shadow:0 1px 2px rgba(0,0,0,.04);transition:background .15s,border-color .15s}
  .card.checked{background:var(--checked);border-color:#f8c9d7}
  .chk-wrap{position:relative;display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;flex:none}
  .chk{appearance:none;width:0;height:0;position:absolute;opacity:0}
  .fake{display:inline-block;width:20px;height:20px;border:2px solid var(--border);border-radius:6px;background:#fff}
  .chk:checked + .fake{border-color:var(--accent);background:var(--accent);
    background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path fill="white" d="M6.6 11.6L3.5 8.5l1.1-1.1 2 2 4-4 1.1 1.1z"/></svg>');
    background-repeat:no-repeat;background-position:center}
  .body{flex:1;min-width:0}
  .title{font-weight:700;white-space:normal;word-break:break-word;line-height:1.35;margin-bottom:2px}
  .meta{margin-top:4px;color:var(--muted);font-size:14px;line-height:1.5}
  .meta .line{white-space:normal;word-break:break-word}
  .meta .line.small{font-size:12px}
  .date-badge{min-width:54px;text-align:center;font-variant-numeric:tabular-nums;color:var(--muted);font-weight:700}
</style>

<header>
  <a class="back" href="index06.html" onclick="return goBack(event)">戻る</a>
  <h1>調布市 巡回</h1>
  <span class="count" id="count">0/0</span>
</header>
<main>
  <div class="toolbar">
    <span class="pill" onclick="alert('データ未収録です');">全てチェック</span>
    <span class="pill" onclick="alert('データ未収録です');">全て外す</span>
    <span class="pill danger" onclick="alert('データ未収録です');">リセット</span>
  </div>
  <p style="color:var(--muted)">調布市のデータは後日追加予定です。</p>
</main>

<script>
function goBack(e){ e.preventDefault(); location.href='index06.html'; return false; }
function mmdd(){
  const d=new Date(); const m=('0'+(d.getMonth()+1)).slice(-2); const day=('0'+d.getDate()).slice(-2); return m+'-'+day;
}
function key(city, idx){ return 'chk:'+city+':'+idx; }
function loadCardState(city, idx){
  try{ return JSON.parse(localStorage.getItem(key(city, idx))) || null; }catch(e){ return null; }
}
function saveCardState(city, idx, checked){
  const v = checked ? {checked:true, date:mmdd()} : {checked:false, date:''};
  localStorage.setItem(key(city, idx), JSON.stringify(v));
}
function applyToCard(card, state){
  const cb = card.querySelector('.chk');
  const dateEl = card.querySelector('.date-badge');
  if(state && state.checked){
    cb.checked = true;
    card.classList.add('checked');
    dateEl.textContent = state.date || mmdd();
  }else{
    cb.checked = false;
    card.classList.remove('checked');
    dateEl.textContent = '';
  }
}
function confirmToggle(){ return confirm('よろしいですか？'); }
function updateCount(city){
  const cards = Array.from(document.querySelectorAll('.card'));
  const total = cards.length;
  const done = cards.filter(c=>c.classList.contains('checked')).length;
  document.getElementById('count').textContent = done + '/' + total;
}
function attachHandlers(city){
  document.querySelectorAll('.card').forEach((card,idx)=>{
    // 初期状態反映
    const st = loadCardState(city, idx);
    applyToCard(card, st);

    // 変更イベント
    const cb = card.querySelector('.chk');
    cb.addEventListener('change', e=>{
      if(!confirmToggle()){ e.target.checked = !e.target.checked; return; }
      const checked = e.target.checked;
      saveCardState(city, idx, checked);
      applyToCard(card, loadCardState(city, idx));
      updateCount(city);
    });
  });
  updateCount(city);
  // Toolbar actions
  const cards = Array.from(document.querySelectorAll('.card'));
  window.checkAll = ()=>{
    if(!confirmToggle()) return;
    cards.forEach((card,idx)=>{ saveCardState(city, idx, true); applyToCard(card, loadCardState(city, idx)); });
    updateCount(city);
  };
  window.uncheckAll = ()=>{
    if(!confirmToggle()) return;
    cards.forEach((card,idx)=>{ saveCardState(city, idx, false); applyToCard(card, loadCardState(city, idx)); });
    updateCount(city);
  };
  window.clearAll = ()=>{
    if(!confirmToggle()) return;
    cards.forEach((card,idx)=>{ localStorage.removeItem(key(city, idx)); applyToCard(card, null); });
    updateCount(city);
  };
}
</script>

<script>document.addEventListener('DOMContentLoaded', ()=> { /* no cards */ });</script>
</html>
