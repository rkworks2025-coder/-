<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>巡回リスト</title>

  <!-- キャッシュ強め対策：バージョンクエリ -->
  <link rel="stylesheet" href="style.css?v=20250830" />
  <style>
    /* 万一 style.css が読み込まれない時の最低限フォールバック */
    :root { --accent:#2b6bf6; --fg:#0e1a2b; --muted:#64748b; --chip:#eff4ff; }
    body{font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; margin:0; background:#f6f7fb; color:var(--fg);}
    .appbar{position:sticky;top:0;z-index:20;display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:#fff;border-bottom:1px solid #e6e8ef;}
    .title{font-size:20px;font-weight:800;letter-spacing:.04em;}
    .btns{display:flex;gap:10px;}
    .btn{appearance:none;border:1px solid #d7dbe7;padding:8px 14px;border-radius:12px;background:#fff;font-weight:700;font-size:14px;}
    .btn-primary{background:var(--chip);border-color:#c9d6ff;color:#1e40af;}
    .wrap{max-width:820px;margin:18px auto;padding:0 14px 60px;}
    .hint{margin:6px 2px 14px;color:var(--muted);font-size:13px}
    .cards{display:grid;grid-template-columns:1fr;gap:14px}
    .card{display:block;text-decoration:none;color:inherit;background:#fff;border:1px solid #e6e8ef;border-radius:16px;padding:18px 16px;box-shadow:0 1px 0 rgba(8,15,35,.03);}
    .card:hover{background:#fafcff}
    .card h2{margin:0 0 8px 0;font-size:18px;letter-spacing:.03em}
    .meta{display:flex;gap:14px;flex-wrap:wrap;color:var(--muted);font-size:13px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:#f2f5fb;border:1px solid #e6e8ef}
    .muted{color:var(--muted)}
    .empty{margin:28px 2px 0 2px;color:var(--muted);font-size:14px}
    /* 進捗モーダル（JS から .show を付け外し） */
    .modal{position:fixed;inset:0;background:rgba(8,15,35,.5);display:none;align-items:center;justify-content:center;z-index:50}
    .modal.show{display:flex}
    .dialog{width:min(520px,90vw);background:#111827;color:#fff;border-radius:14px;padding:18px 16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .barwrap{height:8px;background:#1f2937;border-radius:999px;overflow:hidden;margin-top:12px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#60a5fa,#a78bfa,#34d399)}
    .dialog h3{margin:0 0 8px 0;font-size:18px}
  </style>
</head>
<body>
  <!-- ヘッダー -->
  <header class="appbar">
    <div class="title">巡回リスト</div>
    <div class="btns">
      <!-- app.js 互換：ID を固定 -->
      <button id="recalcBtn" class="btn">再計算</button>
      <button id="syncBtn"   class="btn btn-primary">同期</button>
    </div>
  </header>

  <main class="wrap">
    <!-- 状態表示（app.js がここを書き換える） -->
    <p id="statusText" class="hint">GASと同期して各エリアに反映します。</p>

    <!-- 都市カード（静的に用意。app.js 側は data-city を見ても、個別 ID を見ても対応できるように） -->
    <section id="cityCards" class="cards">
      <a id="card-yamato" class="card" href="yamato.html" data-city="大和市">
        <h2>大和市</h2>
        <div class="meta">
          <span class="chip">済 <span id="yamato-done">0</span></span>
          <span class="chip">停 <span id="yamato-stop">0</span></span>
          <span class="chip">不要 <span id="yamato-skip">0</span></span>
          <span class="chip">総 <span id="yamato-total">0</span></span>
        </div>
      </a>

      <a id="card-ebina" class="card" href="ebina.html" data-city="海老名市">
        <h2>海老名市</h2>
        <div class="meta">
          <span class="chip">済 <span id="ebina-done">0</span></span>
          <span class="chip">停 <span id="ebina-stop">0</span></span>
          <span class="chip">不要 <span id="ebina-skip">0</span></span>
          <span class="chip">総 <span id="ebina-total">0</span></span>
        </div>
      </a>

      <a id="card-chofu" class="card" href="chofu.html" data-city="調布市">
        <h2>調布市</h2>
        <div class="meta">
          <span class="chip">済 <span id="chofu-done">0</span></span>
          <span class="chip">停 <span id="chofu-stop">0</span></span>
          <span class="chip">不要 <span id="chofu-skip">0</span></span>
          <span class="chip">総 <span id="chofu-total">0</span></span>
        </div>
      </a>
    </section>

    <!-- 全体合計（必要なら app.js が使用） -->
    <p id="overallHint" class="empty">まだ同期されていません</p>
  </main>

  <!-- 同期中モーダル -->
  <div id="progressModal" class="modal" aria-hidden="true">
    <div class="dialog">
      <h3 id="progressTitle">同期中…</h3>
      <div class="barwrap"><div id="progressBar" class="bar"></div></div>
    </div>
  </div>

  <!-- スクリプト（キャッシュ回避クエリ） -->
  <script src="app.js?v=20250830"></script>
  <script>
    // 互換レイヤ（app.js が存在しない/読み込めない時でも最低限の保険）
    (function () {
      const hasApp = typeof window.JunkaiApp !== "undefined";
      // もし app.js でグローバルを出しているならそれに任せる
      if (hasApp && typeof window.JunkaiApp.mountIndex === "function") {
        window.JunkaiApp.mountIndex({
          els: {
            syncBtn: document.getElementById("syncBtn"),
            recalcBtn: document.getElementById("recalcBtn"),
            statusText: document.getElementById("statusText"),
            progressModal: document.getElementById("progressModal"),
            progressBar: document.getElementById("progressBar"),
            // per-city IDs（両対応）
            cityCards: document.getElementById("cityCards"),
            yamato: { done:"#yamato-done", stop:"#yamato-stop", skip:"#yamato-skip", total:"#yamato-total" },
            ebina : { done:"#ebina-done",  stop:"#ebina-stop",  skip:"#ebina-skip",  total:"#ebina-total"  },
            chofu : { done:"#chofu-done",  stop:"#chofu-stop",  skip:"#chofu-skip",  total:"#chofu-total"  },
          }
        });
      } else {
        // app.js が無い時の簡易ワイヤリング（ボタンは生きているように見せるだけ）
        const modal = document.getElementById("progressModal");
        const bar   = document.getElementById("progressBar");
        const sync  = document.getElementById("syncBtn");
        const rec   = document.getElementById("recalcBtn");
        const stxt  = document.getElementById("statusText");

        function fakeProgress() {
          modal.classList.add("show");
          let t = 0, id = setInterval(()=>{
            t = (t+7)%100;
            bar.style.width = t + "%";
          }, 80);
          setTimeout(()=>{ clearInterval(id); modal.classList.remove("show"); alert("同期完了（デモ）"); }, 1200);
        }
        if (sync)  sync.addEventListener("click", fakeProgress);
        if (rec)   rec.addEventListener("click", ()=>{ stxt.textContent = "再計算しました（デモ）"; });
      }
    })();
  </script>
</body>
</html>
