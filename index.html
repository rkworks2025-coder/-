<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>巡回リスト インデックス</title>

<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif; margin: 0; background:#f7f7f9; }
  header { position: sticky; top: 0; background: #fff; padding: 12px 16px; box-shadow: 0 1px 6px rgba(0,0,0,0.08); display:flex; align-items:center; gap:12px; }
  header a { text-decoration:none; }
  .title { font-size: 18px; font-weight: 700; }
  .sub { color:#666; font-size: 13px; }
  .container { padding: 16px; }
  .card { background:#fff; border-radius:12px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); padding: 14px; margin-bottom: 16px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border-bottom: 1px solid #eee; padding: 10px 8px; text-align: left; }
  th { position: sticky; top: 56px; background: #fafafa; z-index: 1; }
  tr.checked { background: #eaf7ea; }
  .badge { display:inline-block; padding: 2px 8px; border-radius: 999px; background:#f0f0f5; font-size:12px; }
  .progress { font-weight:700; }
  .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px; }
  .btn { display:inline-block; padding: 8px 12px; border-radius: 10px; background:#f0f2ff; text-decoration:none; }
  .muted { color:#777; font-size:12px; }
</style>


<script>
// MM-DD 形式で日付文字列を返す
function formatDateMMDD(date = new Date()) {
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${m}-${d}`;
}

// 都市ページ：チェック状態を読み書きするキー
function makeKey(city, reg) {
  return `巡回チェック:${city}:${reg}`;
}

// 行を適用
function applyRowState(tr, city, reg) {
  const key = makeKey(city, reg);
  const saved = localStorage.getItem(key);
  const checkbox = tr.querySelector('input[type="checkbox"]');
  const dateCell = tr.querySelector('.date-cell');
  if (saved) {
    checkbox.checked = true;
    tr.classList.add('checked');
    dateCell.textContent = saved;
  } else {
    checkbox.checked = false;
    tr.classList.remove('checked');
    dateCell.textContent = '';
  }
}

// 都市ページ：進捗更新
function updateProgress(city) {
  const rows = Array.from(document.querySelectorAll('tbody tr'));
  const total = rows.length;
  const done = rows.filter(r => r.classList.contains('checked')).length;
  const percent = total ? Math.round(done * 100 / total) : 0;
  document.querySelector('#progress').textContent = `${done}/${total}（${percent}%）`;
}

// 都市ページ：初期化
function initCityPage(city) {
  // 既存状態を反映
  document.querySelectorAll('tbody tr').forEach(tr => {
    const reg = tr.dataset.reg;
    applyRowState(tr, city, reg);
  });
  updateProgress(city);

  // 変更イベント
  document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', (e) => {
      const tr = e.target.closest('tr');
      const reg = tr.dataset.reg;
      const key = makeKey(city, reg);
      const dateCell = tr.querySelector('.date-cell');

      const proceed = confirm('よろしいですか？');
      if (!proceed) {
        e.target.checked = !e.target.checked; // 元に戻す
        return;
      }
      if (e.target.checked) {
        const mmdd = formatDateMMDD();
        localStorage.setItem(key, mmdd);
        tr.classList.add('checked');
        dateCell.textContent = mmdd;
      } else {
        localStorage.removeItem(key);
        tr.classList.remove('checked');
        dateCell.textContent = '';
      }
      updateProgress(city);
      // 全体進捗を更新（index側で再読込時に反映される想定）
    });
  });
}

// Index：全都市の進捗算出
function computeCityProgress(city, regs) {
  let done = 0;
  regs.forEach(reg => {
    const key = makeKey(city, reg);
    if (localStorage.getItem(key)) done++;
  });
  const total = regs.length;
  const percent = total ? Math.round(done * 100 / total) : 0;
  return { done, total, percent };
}

</script>

<body onload="(function(){ 
        (function() {
          const result = computeCityProgress('海老名市', ['相模501ワ8181','相模501ワ6814','相模300ワ5668','相模501ワ8127','相模501ワ7594','相模501ワ7277','相模501ワ8033','相模300ワ5603','相模501ワ6239','相模300ワ5604','相模501ワ7298','相模300ワ5827','相模300ワ6044','相模580ワ4011','相模501ワ8910','相模300ワ4926','相模300ワ4508','相模580ワ3114','相模300ワ4907','相模501ワ7816','相模501ワ8184','相模580ワ3376','相模501ワ7095','相模501ワ9444','相模501ワ7864','相模300ワ5328','相模501ワ7611','相模300ワ4912','相模501ワ9383','相模501ワ9403','相模501ワ7924','相模501ワ5975','相模501ワ7911','相模501ワ7040','相模501ワ8985','相模501ワ6811','相模501ワ7065','相模300ワ5669','相模501ワ8018','相模501ワ7250','相模501ワ8977','相模501ワ6185','相模501ワ7312','相模501ワ9089','相模501ワ8863','相模501ワ8028','相模501ワ7819','相模501ワ6815','相模501ワ8851','相模501ワ6369','相模501ワ5990','相模501ワ6041','相模580ワ2448','相模501ワ8185','相模501ワ8250','相模501ワ9122','相模501ワ9608','相模501ワ7308','相模580ワ3039','相模501ワ8357','相模501ワ8370','相模300ワ5939','相模580ワ4015','相模501ワ9095','相模501ワ8186','相模501ワ5731','相模300ワ5908','相模501ワ8015','相模300ワ6071','相模300ワ6041','相模501ワ8520','相模300ワ5854','相模501ワ8152','相模501ワ9335','相模501ワ8626','相模501ワ8198','相模501ワ7147','相模501ワ9288','相模501ワ5976','相模501ワ9283','相模300ワ5174','相模300ワ4680','相模501ワ5721','相模501ワ5783','相模300ワ4782','相模300ワ5332','相模501ワ8150','相模300ワ6019','相模501ワ9310']);
          const el = document.querySelector('#p-海老名市');
          if (el) el.textContent = `${result.done}/${result.total}（${result.percent}%）`;
          window.__acc_done = (window.__acc_done || 0) + result.done;
          window.__acc_total = (window.__acc_total || 0) + result.total;
        })();
        

        (function() {
          const result = computeCityProgress('大和市', ['相模501ワ6171','相模501ワ7871','相模501ワ7546','相模580ワ3097','相模300ワ6124','相模300ワ6039','相模300ワ4776','相模501ワ8699','相模501ワ8158','相模501ワ7589','相模501ワ7590','相模501ワ7810','相模300ワ5415','相模300ワ5170','相模501ワ9437','相模501ワ6404','相模501ワ5882','相模501ワ6029','相模300ワ4332','相模300ワ5304','相模300ワ5774','相模501ワ9194','相模501ワ8077','相模501ワ6630','相模501ワ8862','相模580ワ4024','相模501ワ7725','相模501ワ7947','相模501ワ8451','相模501ワ6843','相模501ワ7293','相模300ワ6189','相模501ワ8272','相模501ワ8625','相模501ワ8034','相模501ワ6819','相模501ワ7772','相模300ワ5566','相模501ワ8779','相模501ワ8270','相模501ワ9375','相模580ワ3578','相模580ワ3236','相模501ワ9233','相模300ワ5652','相模300ワ5331','相模501ワ9101','相模501ワ8234','相模501ワ5884','相模300ワ4779','相模580ワ3324','相模501ワ8078','相模501ワ7865','相模501ワ9395','相模501ワ9248','相模501ワ9121','相模501ワ8925','相模501ワ7781','相模501ワ9446','相模501ワ6380']);
          const el = document.querySelector('#p-大和市');
          if (el) el.textContent = `${result.done}/${result.total}（${result.percent}%）`;
          window.__acc_done = (window.__acc_done || 0) + result.done;
          window.__acc_total = (window.__acc_total || 0) + result.total;
        })();
         const d=window.__acc_done||0; const t=window.__acc_total||149; const p=t?Math.round(d*100/t):0; document.querySelector('#all-progress').textContent = `${d}/${t}（${p}%）`; })()">
<header>
  <div class="title">巡回リスト インデックス</div>
  <div class="sub">端末内（localStorage）にチェック状態を保存。リンクから各エリアへ。</div>
</header>
<div class="container">
  <div class="card" style="margin-bottom:18px;">
    <div class="title">全エリア達成度</div>
    <div class="badge"><span id="all-progress">0/0（0%）</span></div>
    <div class="muted" style="margin-top:6px;">※ 現在は「海老名市・大和市」のみ。調布市は後日追加予定。</div>
  </div>
  <div class="grid">
    
        <a class="card" href="海老名市.html">
          <div class="title">海老名市</div>
          <div class="sub">X/Y（%）は端末内の進捗を自動計算</div>
          <div class="badge">進捗 <span id="p-海老名市">0/89（0%）</span></div>
        </a>
        

        <a class="card" href="大和市.html">
          <div class="title">大和市</div>
          <div class="sub">X/Y（%）は端末内の進捗を自動計算</div>
          <div class="badge">進捗 <span id="p-大和市">0/60（0%）</span></div>
        </a>
        
  </div>
</div>
</body>
</html>